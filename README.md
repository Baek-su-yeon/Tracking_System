## 🚀 Ezi-SERVO 기반 2축 리니어 스테이지 트래킹 시스템 (Closed-Loop Stepping System Tracking)

### 🎯 프로젝트 개요

본 프로젝트는 FASTECH의 Ezi-SERVO II Plus-E 드라이브를 사용하여 두 개의 리니어 스테이지 축(추종 축 및 등속 축)을 정밀 제어하고, 웹캠 기반의 영상 처리 좌표를 추종하여 실시간 트래킹을 구현하는 시스템입니다.

| 항목 | 내용 |
| :--- | :--- |
| **프로젝트 목적** | 영상 처리 기반의 실시간 좌표 획득 및 Ezi-SERVO 드라이브를 이용한 정밀한 2축 위치 추종 및 제어. |
| **타겟 하드웨어** | Ezi-SERVO II Plus-E 드라이브 (2축), 리니어 스테이지 (2축), 웹캠. |
| **개발 환경** | Visual Studio (MFC 기반 GUI), C++. |

***

### ⚙️ 시스템 구성 및 주요 기술

#### 1. 하드웨어 구성

| 구분 | 역할 | ID / IP |
| :--- | :--- | :--- |
| **추종 축** (Axis X) | 카메라 좌표를 실시간으로 추종 | BD\_ID\_10 (192.168.0.10) |
| **등속 축** (Axis Y) | 배경 등속 운동 구현 | BD\_ID\_11 (192.168.0.11) |
| **카메라** | 영상 획득 및 타겟 좌표 추출 | ID 0 (기본 웹캠) |

#### 2. 사용된 핵심 기술

| 기술 분야 | 주요 내용 |
| :--- | :--- |
| **모션 제어** | FASTECH Ezi-SERVO II Plus-E 전용 라이브러리 (DLL)를 이용한 TCP/UDP 통신 제어|
| **위치 추종** | FAS\_MoveSingleAxisAbsPos 및 **Position Override** 명령을 활용한 실시간 좌표 갱신|
| **컴퓨터 비전** | **OpenCV**를 이용한 영상 캡처 및 화면 출력 (cv::VideoCapture, cv::Mat). |
| **GUI 및 스레딩** | MFC (Microsoft Foundation Class) 기반의 사용자 인터페이스 및 모니터링/트래킹 로직의 **다중 스레드 분리** (OnTimer, CreateThread). |

***

### ✅ 구현된 주요 기능

#### 1. 드라이브 연결 및 상태 제어

* **연결/해제 및 서보 ON/OFF:** 각 축별로 통신 연결(FAS\_ConnectTCP)과 서보 ON/OFF (FAS\_ServoEnable)를 통합 관리합니다.
* **상태 모니터링:** 30FPS 주기로 각 축의 **Command Pos**, **Actual Pos**, **Position Error** 및 **RPM** 정보를 실시간으로 GUI에 출력합니다.
* **Jog 운전:** GUI 버튼을 통한 드라이브의 **Jog 운전 시작/정지** 기능을 구현했습니다.

#### 2. 원점 복귀 및 위치 초기화 기능

* **다양한 원점 복귀 방식 지원:** GUI의 콤보박스 선택을 통해 Ezi-SERVO 드라이브가 제공하는 8가지 원점 복귀 방식 (Method 0~7) 중 하나를 선택하여 실행할 수 있습니다.
    * 선택된 Method 번호를 파라미터로 설정 후 원점 복귀 명령(**FAS\_MoveOriginSingleAxis**)을 실행합니다.
* **위치 초기화 (Set Origin):** Method 4 (Set Origin) 선택 시, 센서 동작 없이 현재 위치를 새로운 원점(0, 0)으로 즉시 설정할 수 있습니다.

#### 3. 카메라 및 영상 출력

* **카메라 초기화:** OpenCV를 통한 웹캠 연결을 시도합니다.
* **실시간 화면 출력:** 획득한 영상 프레임을 MFC Picture Control에 실시간으로 출력합니다.
* **안정성 확보:** 카메라 연결 실패 시, 화면에 **"No Camera"** 메시지를 출력하도록 폴백(Fallback) 로직이 구현되어 있습니다.

#### 4. 트래킹 루프 (Threading)

* **별도 스레드 운영:** 트래킹 및 좌표 갱신 로직은 GUI의 응답성을 보장하기 위해 별도의 스레드에서 실행됩니다.
* **현재 기능:** 임의의 좌표를 생성하여 추종 축에 명령을 내리는 **랜덤 시뮬레이션 트래킹** 기능이 구현되어 있습니다. (향후 영상 처리 좌표 획득 로직으로 대체 예정)

***

### ⚠️ 배포 및 실행 가이드
준비 중